{% load static %}
{% load extra_filters %}

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">

        <!-- Logo Organization.supply -->
        <a href="{% url 'user_organizations' %}">
            <img src="{% static 'logo/organization-supply-logo-no-border.png' %}" alt="Organization.supply" style="width: 20px; margin-top: -4px; margin-right: 10px; filter: invert(1)"/>
        </a>
        
        <!-- Tenant name -->
        {% if request.organization.name %}
            <a class="navbar-tenant" href="{% url 'organization_dashboard' request.organization.slug %}">
                {{ request.organization.name|title }}
            </a>
        {% else %}
            <a class="navbar-tenant" href="{% url 'user_organizations' %}">
                Organization.supply
            </a>
        {% endif %}
            
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarToggle" aria-controls="navbarToggle" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Menu -->
        <div class="collapse navbar-collapse" id="navbarToggle">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <!-- Organization links -->
                {% if request.organization.slug %}
                    <li class="nav-item"><a class="nav-link" href="{% url 'organization_dashboard' request.organization.slug %}" title="Dashboard">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'organization_notifications' request.organization.slug %}" title="Notifications">Notifications</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'organization_search' request.organization.slug %}" title="Search">Search</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'organization_products' request.organization.slug %}" title="Products">Products</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'organization_locations' request.organization.slug %}" title="Locations">Locations</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'organization_inventory_location' request.organization.slug %}" title="Inventory">Inventory</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'organization_mutations' request.organization.slug %}" title="Transactions">Transactions</a></li>
                {% endif %}
            </ul>

            <div class="d-flex">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <!-- Dropdown menu -->
                    <li class="dropdown">
                        
                        <a class="nav-link dropdown-toggle" type="button" id="dropdownMenuButton2" data-bs-toggle="dropdown" aria-expanded="false">

                            {% if request.user.notifications_unread %}
                            <span class="badge bg-light text-dark">{{ request.user.notifications_unread|length }}</span>
                            {% endif %}
                            
                            <!-- Avatar -->
                            {% if request.user.image %}
                                <img class="avatar rounded" width="30px" alt="{{ request.user.name }}" src="{{ request.user.image.url }}" alt="">
                                {{ request.user.name }}
                            {% elif request.user.name %}
                                {{ request.user.name }}
                            {% else %}
                                {{ request.user.email }}
                            {% endif %}

                        </a>
                        
                        <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end" aria-labelledby="navbarDropdown">
                            <!-- Organization links on mobile -->
                            {% if request.organization.slug %}
                                {% if request.user|is_organization_admin_in:request.organization %}
                                    <li><a class="dropdown-item" href="{% url 'organization_settings' request.organization.slug %}" title="Settings">Organization Settings</a></li>
                                {% endif %}
                                <li><hr class="dropdown-divider"></li>
                            {% endif %}
                            <!-- </span> -->
    
                            <!-- User links (always visible) -->
                            <li><a class="dropdown-item" href="{% url 'user_organizations' %}" title="Organizations">Organizations</a></li>
                            <li><a class="dropdown-item" href="{% url 'user_notifications' %}" title="Notifications">Notifications 
                                <span class="badge bg-light text-dark">{{ request.user.notifications_unread|length }}</span>
                            </a></li>
                            <li><a class="dropdown-item" href="{% url 'user_settings' %}" title="Settings">Settings</a></li>
                            <li><a class="dropdown-item" href="{% url 'logout' %}" title="Logout">Logout</a></li>
                        </ul>
                    </li>
                </ul>
        </div>

        
        </div>
    </div>
</nav>